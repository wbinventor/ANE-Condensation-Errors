%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Methodology}
\label{sec:methodology}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

Two case studies were used to disaggregate the approximation errors inherent to deterministic multi-group transport methods from the component error specific to the flux separability approximation. Ultra-fine deterministic and continuous energy Monte Carlo transport methods were used to collapse multi-group cross sections and generate reference solutions for each case study as discussed in~\autoref{subsec:test-case1} and~\autoref{subsec:test-case2}, respectively. Both case studies modeled a multi-region PWR fuel pin geometry with varying levels of complexity. The two analyses isolate the impact of the flux separability approximation on local reaction rates, as well as demonstrate the compounding effect of errors in each energy group on the $k$-eigenvalue. The following sections discuss the benchmark specifications and simulation tools used by each case study.

% hammer home that all of this is due to heterogeneous effects:


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Test Case 1: Pin Cell with Slowing Down Source}
\label{subsec:test-case1}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{Benchmark Problem}
\label{subsubsec:benchmark-case1}

The first test case modeled a simple benchmark problem in which the reference flux could be computed precisely to demonstrate the existence of errors from approximately collapsing Eqn.~\ref{eqn:transport-eqn-ce} into Eqn.~\ref{eqn:transport-eqn-mg-separate} with the flux separability approximation. The first test case problem consisted of a unit cell of an infinite array of unclad fuel pins. The fuel material contained U-238 with an atom density of 0.022 $\nicefrac{\text{a}}{\text{b-cm}}$ and a purely scattering nuclide with a constant cross section of 0.176 cm\textsuperscript{-1}, an analog to oxygen in UO\textsubscript{2}. The moderator was a pure scatterer with a constant cross section of 1.23 cm\textsuperscript{-1}. The pin radius is 0.4 cm and the pitch was 1.26 cm. The source was given by the scatter source from the narrow resonance approximation:

\begin{dmath}
\label{eqn:test-source-ce}
Q(\mathbf{r},\mathbf{\Omega},E) = \frac{1}{4\pi} \frac{\Sigma_{p}(\mathbf{r})}{E}
\end{dmath}

% do you (instead) have a case where you analyze a single resonance with different peak/widths???

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{Simulation Tools}
\label{subsubsec:sim-tools-case1}

A reference continuous energy flux was computed for the first test case by solving Eqn.~\ref{eqn:transport-eqn-mg-separate} for each energy point {\color{red}[using a toy MOC code? Spatial and angular discretization?]}. The reference reaction rates in each region were obtained by integrating the flux multiplied by a cross section over an energy range of interest and over the volume of the fuel pin. The total cross section and souce were collapsed using the reference flux according to Eqns.~\ref{eqn:sigt-mg-scalar} and~\ref{eqn:groupwise-source}, respectively. Eqn.~\ref{eqn:transport-eqn-mg-separate} was solved using {\color{red}[using a toy MOC code? Spatial and angular discretization?]} the collapsed total cross section and source. The collapsed reaction rate was obtained by volume-integrating the multi-group flux multiplied by the multi-group cross section over the fuel pin. Finally, the reaction rates obtained from the multi-group and reference calculations were compared in each energy group to identify any bias due to the flux separability approximation.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Test Case 2: A Critical PWR Fuel Pin}
\label{subsec:test-case2}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{Benchmark Problem}
\label{subsubsec:benchmark-case2}

The second test case modeled a four-region PWR fuel pin, including  2.4\% UO\textsubscript{2} fuel, helium gap, zircaloy clad and borated light water moderator. This benchmark was derived from the BEAVRS PWR model and the material specifications are detailed by~\cite{horelik2013beavrs}. The geometric specifications are reproduced in~\autoref{table:pin-dimensions}. The benchmark geometry is illustrated in~\autoref{fig:pin-materials}. The fuel and moderator were each discretized into sixteen radial zones for spatial homogenization\footnote{Equal volume radial rings were used in the fuel; equally spaced radial rings were used in the moderator.} as shown in~\autoref{fig:pin-rings} for which unique MGXS were generated and employed in multi-group transport calculations.

\begin{table}[h!]
  \centering
  \caption{2D fuel pin dimensions.}
  \label{table:pin-dimensions} 
  \begin{tabular}{l c}
  \toprule
  \multicolumn{1}{c}{\bf Material} &
  {\bf Dimension [cm]} \\
  \midrule
  Fuel Outer Radius & 0.39218 \\
  Gap Outer Radius &  0.40005 \\
  Clad Outer Radius & 0.45720 \\
  Pin Pitch &         1.25984 \\
  \bottomrule
\end{tabular}
\end{table}

\begin{figure}[h!]
\centering
\begin{subfigure}{.25\textwidth}
  \includegraphics[width=0.9\linewidth]{figures/pin-cell-simple}
  \caption{}
  \label{fig:pin-materials}
\end{subfigure}%
\begin{subfigure}{.25\textwidth}
  \centering
  \includegraphics[width=0.9\linewidth]{figures/pin-cell-16x1}
  \caption{}
  \label{fig:pin-rings}
\end{subfigure}
\caption{The PWR fuel pin cell materials (a) and MGXS spatial homogenization zones (b) for the second test case benchmark.}
\label{fig:pin-cell}
\end{figure}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Simulation Tools}
\label{subsubsec:sim-tools-case2}

The OpenMC continuous energy Monte Carlo code~\citep{romano2013openmc} was employed to generate multi-group cross sections, and reference multi-group reaction rates and fluxes, for the second test case. The \texttt{openmc.mgxs} Python module was used to tally multi-group cross sections in CASMO's seventy energy group structure~\citep{rhodes2006casmo} for each of the radial spatial zones illustrated in Fig.~\ref{fig:pin-rings} from a single eigenvalue calculation. The MGXS were tallied using the scalar flux (Eqn.~\ref{eqn:sigt-mg-scalar}) according to the flux separability approximation. The same Monte Carlo simulation was used to compute a reference eigenvalue, as well as reference multi-group fluxes and reaction rates for each energy group and spatial region. A total of 10 active and 100 inactive batches of 10\textsuperscript{8} particles per batch were simulated. 

The OpenMOC multi-group code~\citep{boyd2014openmoc} was employed to model the second test case benchmark using the MGXS generated by OpenMC. The OpenMOC code is a 2D deterministic method of characteristics code designed for fixed source and eigenvalue neutron transport calculations. The benchmark geometry illustrated in Fig.~\ref{fig:pin-rings} was further discretized for OpenMOC's transport solver with eight azimuthal sectors within each radial ring. A series of multi-group calculations were performed with OpenMOC using the 70-group MGXS tabulated by OpenMC and subsequently collapsed into 1, 2, 8, 16, 25, 40 coarse energy groups. Finally, the OpenMOC eigenvalue and multi-group fluxes were compared with the reference solution computed by OpenMC.

It should be noted that two different OpenMC simulations were performed with different scattering kernels to generate two different MGXS libraries for OpenMOC. The first simulation employed all of the normal scattering physics modeled in OpenMC. The second simulation used OpenMC's ``iso-in-lab'' feature\footnote{The OpenMC ``iso-in-lab'' feature samples the outgoing neutron energy from the scattering laws prescribed by the continuous energy cross section library, but the outgoing neutron direction of motion is sampled from an isotropic in lab distribution.} to enforce isotropic in lab scattering. Although isotropic scattering is not a valid approximation for nuclear reactors, the ``iso-in-lab'' feature enabled comparisons between the reference eigenvalues and reaction rates produced by OpenMC and those computed from isotropic multi-group calculations with OpenMOC. Furthmore, the separate calculations enabled a comparison of the effects due to isotropic in lab scattering and the flux separability approximation.